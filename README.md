
# CounterBackupTL

Данный скрипт был создан для того чтобы считать кол-во файлов за определенное заданное время в заданной папке.
 

## Логика работы:
*Скрипт заходит в указанное папку, считает кол-во подпапок в ней, а потом заходит в каждую эту подпапку и проверяет сколько файлов было создано за заданное кол-во минут, например 15.*

## Запуск:
Для его запуска необходимо указать два параметра: **minutes и folderPath**.
Если minutes не указаны, то будет считать за последние **15 минут**.

```ps1
.\counterBackUp24.ps1 -folderPath "Z:\=Backup=\SQL2019\Buh-SQL\MINUTES" -minutes 15
```
Далее скрипт вешается в планировщике заданий на запуск каждые 15 минут соответственно или на то сколько считаем, например, если считаем дневные бекапы, то команда будет выглядеть
```ps1
.\counterBackUp24.ps1 -folderPath "Z:\=Backup=\SQL2019\Buh-SQL\DAY" -minutes 1440
```
## Логи
Если было найдено несовпадение, то скрипт запишет лог по пути  **C:\Util\log_counter.txt**, логи от каждого запуска разделены для удобства чтения, так же **если лог весит больше 10кб, то он будет очищен**.

## Zabbix
Далее в **zabbix** создается триггер на проверку файла **C:\Util\log_counter.txt**, если этот файл изменялся в течении **15** минут или **1440** соответственно, то должен сработать триггер.
Пример итема: 

> vfs.file.time[C:\Util\log_counter.txt,modify]

Пример триггера: 

> **now()** - last(/WMS-Backup/vfs.file.time[C:\Util\log_counter.txt,modify])>900

Где **now()** - текущее время.
А **900** - время в секундах. 